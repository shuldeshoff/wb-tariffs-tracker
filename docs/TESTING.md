# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä–æ–µ–∫—Ç–∞ WB Tariffs Service.

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ unit/                           # –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ wildberries.service.test.ts
‚îÇ   ‚îú‚îÄ‚îÄ tariffs.repository.test.ts
‚îÇ   ‚îú‚îÄ‚îÄ data-processing.service.test.ts
‚îÇ   ‚îú‚îÄ‚îÄ google-sheets.service.test.ts
‚îÇ   ‚îî‚îÄ‚îÄ scheduler.test.ts
‚îú‚îÄ‚îÄ integration/                    # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (–±—É–¥—É—â–µ–µ)
‚îî‚îÄ‚îÄ mocks/                          # –ú–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    ‚îî‚îÄ‚îÄ data.ts
```

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –í—Å–µ —Ç–µ—Å—Ç—ã

```bash
npm test
```

### Watch —Ä–µ–∂–∏–º (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö)

```bash
npm run test:watch
```

### –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞

```bash
npm run test:coverage
```

–û—Ç—á–µ—Ç –æ –ø–æ–∫—Ä—ã—Ç–∏–∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ `coverage/index.html`.

## üìù –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

### WildberriesService

**–§–∞–π–ª:** `tests/unit/wildberries.service.test.ts`

–¢–µ—Å—Ç–∏—Ä—É–µ—Ç:
- –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç WB API
- Retry-–ª–æ–≥–∏–∫—É –ø—Ä–∏ —Å–±–æ—è—Ö (3 –ø–æ–ø—ã—Ç–∫–∏)
- –û–±—Ä–∞–±–æ—Ç–∫—É –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ (4xx) –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- –û–±—Ä–∞–±–æ—Ç–∫—É –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ API
- –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –∏–∑ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

### TariffsRepository

**–§–∞–π–ª:** `tests/unit/tariffs.repository.test.ts`

–¢–µ—Å—Ç–∏—Ä—É–µ—Ç:
- UPSERT –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤ –ø–æ –¥–∞—Ç–µ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç–∞—Ä–∏—Ñ–æ–≤
- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π
- –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –ë–î

### DataProcessingService

**–§–∞–π–ª:** `tests/unit/data-processing.service.test.ts`

–¢–µ—Å—Ç–∏—Ä—É–µ—Ç:
- –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø–æ–ª—É—á–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö API –≤ —Ñ–æ—Ä–º–∞—Ç –ë–î
- –û–±—Ä–∞–±–æ—Ç–∫—É –ø—É—Å—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã

### GoogleSheetsService

**–§–∞–π–ª:** `tests/unit/google-sheets.service.test.ts`

–¢–µ—Å—Ç–∏—Ä—É–µ—Ç:
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ Google Sheets
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–∞–±–ª–∏—Ü
- –û—á–∏—Å—Ç–∫—É –∏ –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö
- –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ç–∞–±–ª–∏—Ü–µ
- –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –¥–æ—Å—Ç—É–ø–∞

### SchedulerService

**–§–∞–π–ª:** `tests/unit/scheduler.test.ts`

–¢–µ—Å—Ç–∏—Ä—É–µ—Ç:
- –ó–∞–ø—É—Å–∫ –∑–∞–¥–∞—á –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –û—Å—Ç–∞–Ω–æ–≤–∫—É –≤—Å–µ—Ö –∑–∞–¥–∞—á
- –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á (running/stopped)
- –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ –∑–∞–¥–∞—á–∞—Ö

## üé≠ –ú–æ–∫–∏

### Mock Data

**–§–∞–π–ª:** `tests/mocks/data.ts`

–°–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:
- `mockWBApiResponse` - –ø—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ WB API —Å 3 —Å–∫–ª–∞–¥–∞–º–∏
- `mockTariffRecords` - –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø–∏—Å–µ–π –ë–î

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

–¶–µ–ª–µ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:
- **Statements:** > 80%
- **Branches:** > 75%
- **Functions:** > 80%
- **Lines:** > 80%

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Jest Config

**–§–∞–π–ª:** `jest.config.js`

–ù–∞—Å—Ç—Ä–æ–π–∫–∏:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ts-jest –¥–ª—è TypeScript
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ES Modules
- Path mapping –¥–ª—è –∞–ª–∏–∞—Å–æ–≤ (`#*`)
- –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `coverage/`

## üß© –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```json
{
  "devDependencies": {
    "jest": "^29.7.0",
    "@types/jest": "^29.5.11",
    "ts-jest": "^29.1.2",
    "@types/node": "^20.11.0"
  }
}
```

## ‚úÖ Best Practices

1. **–ò–∑–æ–ª—è—Ü–∏—è —Ç–µ—Å—Ç–æ–≤:** –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º –∏ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ
2. **–ú–æ–∫–∏:** –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–æ–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (API, –ë–î)
3. **–û—á–∏—Å—Ç–∫–∞:** `clearMocks`, `resetMocks`, `restoreMocks` –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞
4. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å:** –û–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
5. **AAA Pattern:** Arrange, Act, Assert –≤ –∫–∞–∂–¥–æ–º —Ç–µ—Å—Ç–µ

## üêõ –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

```bash
npm test -- wildberries.service.test.ts
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

```bash
npm test -- -t "–¥–æ–ª–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–∞—Ä–∏—Ñ—ã"
```

### Verbose —Ä–µ–∂–∏–º

```bash
npm test -- --verbose
```

## üìà –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `*.test.ts` –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Ç–∏–ª–∏—Ç—ã –∏–∑ `@jest/globals`
3. –°–æ–∑–¥–∞–π—Ç–µ –º–æ–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
4. –ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ—Å—Ç—ã —Å–ª–µ–¥—É—è —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:

```typescript
describe("ComponentName", () => {
    beforeEach(() => {
        // Setup
    });

    describe("methodName", () => {
        it("–¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å —á—Ç–æ-—Ç–æ", () => {
            // Arrange
            // Act
            // Assert
        });
    });
});
```

## üîÑ CI/CD Integration

–¢–µ—Å—Ç—ã –º–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ CI/CD pipeline:

```yaml
# .github/workflows/test.yml
- name: Run tests
  run: npm test
  
- name: Upload coverage
  run: npm run test:coverage
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Jest Documentation](https://jestjs.io/docs/getting-started)
- [Testing TypeScript](https://jestjs.io/docs/getting-started#via-ts-jest)
- [Testing Best Practices](https://github.com/goldbergyoni/javascript-testing-best-practices)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 22 –æ–∫—Ç—è–±—Ä—è 2025

